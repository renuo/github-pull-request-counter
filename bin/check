#!/bin/sh

set -e

bin/build
bin/fastcheck || {
  echo '\033[31mFix the linting issues before running the tests.\033[0m'
  exit 1
}

echo "Building extension"
export ENV=testing
export EXTENSION_TEST_KEY="$(cat webpack.common.js | grep TESTING_KEY | cut -d'"' -f2)"
bin/build || {
  echo '\033[31mFailed to build extension.\033[0m'
  exit 1
}

echo "Executing jest"
npm run test
